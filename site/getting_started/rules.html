


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <link rel="canonical" href="https://greydongilmore.github.io/seek-website/getting_started/rules.html">
      
      
      <link rel="shortcut icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.3.3">
    
    
      
        <title>rules</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.545621a7.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.36d1b78f.min.css">
      
      
        
        
        <meta name="theme-color" content="#ef5350">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="red" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://greydongilmore.github.io/seek-website/" title="SEEK" class="md-header-nav__button md-logo" aria-label="SEEK">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z" fill-opacity=".5"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z" fill-opacity=".25"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            SEEK
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              rules
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/ncsl/seek/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    SEEK on Github
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://greydongilmore.github.io/seek-website/" title="SEEK" class="md-nav__button md-logo" aria-label="SEEK">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z" fill-opacity=".5"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z" fill-opacity=".25"/></svg>

    </a>
    SEEK
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/ncsl/seek/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    SEEK on Github
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../index.html" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Getting started
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Getting started" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Getting started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="installation_guide.html" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="pipeline_description.html" title="Pipeline Description" class="md-nav__link">
      Pipeline Description
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="localization_guide.html" title="Localization Guide" class="md-nav__link">
      Localization Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="data_description.html" title="Dataset Description" class="md-nav__link">
      Dataset Description
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
    <a href="rules.html" title="Rules" class="md-nav__link md-nav__link--active">
      Rules
    </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../contributing.html" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../license.html" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
  
    <a href="https://github.com/greydongilmore/seek-website/blob/master/docs/getting_started/rules.md" title="Edit this page" class="md-content__button md-icon" target="blank_" style="font-size: 14px;">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> <p style="margin-top:2px;">Edit this page</p>
    </a>
    <a href="https://github.com/ncsl/seek/issues/new/choose" title="Open an issue" class="md-content__button md-icon" target="blank_" style="font-size: 14px;">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> <p style="margin-top:2px;">Open and issue</p>
    </a>
  
  
    
  
  
    <h1>Rules</h1>
  
  <p>As of August 2017, <strong>Sequana</strong> has about 80 different rules. The list is available from the <a href="https://github.com/sequana/sequana/tree/master/sequana/rules" target="blank_">source code</a>. We design our rules following some strict conventions as explained in the :ref:<code>developers</code> section.</p>
<p>Rules are documented and we developed a Sphinx extension to automatically add their docstring in this documentation. For example, the documentation of the rule <strong>fastq_sampling</strong> looks like:</p>
<details class="note"><summary>01-Prep Snakemake rule</summary><div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">===============================================</span>
<span class="sd">01. Prep Reconstruction Workflow and BIDS Layout</span>
<span class="sd">===============================================</span>

<span class="sd">In this pipeline, we prep the reconstruction workflow</span>
<span class="sd">by putting MRI and CT data into the BIDS layout and</span>
<span class="sd">re-orient images to RAS with ACPC alignment.</span>

<span class="sd">We assume that there is only one set of dicoms for CT and MRI</span>
<span class="sd">data.</span>

<span class="sd">This pipeline depends on the following functions:</span>

<span class="sd">    * mrconvert</span>
<span class="sd">    * acpcdetect</span>

<span class="sd">from FreeSurfer6+, acpcdetect2.0. To create a DAG pipeline, run:</span>

<span class="sd">    snakemake --dag | dot -Tpdf &gt; dag_pipeline_reconstruction.pdf</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Authors: Adam Li &lt;adam2392@gmail.com&gt;</span>
<span class="c1"># License: GNU</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;../../../&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">seek.pipeline.fileutils</span> <span class="kn">import</span> <span class="p">(</span><span class="n">BidsRoot</span><span class="p">,</span> <span class="n">BIDS_ROOT</span><span class="p">,</span> <span class="n">_get_seek_config</span><span class="p">,</span>
                                     <span class="n">_get_anat_bids_dir</span><span class="p">,</span> <span class="n">_get_bids_basename</span><span class="p">)</span>

<span class="n">configfile</span><span class="p">:</span> <span class="n">_get_seek_config</span><span class="p">()</span>

<span class="c1"># get the freesurfer patient directory</span>
<span class="n">bids_root</span> <span class="o">=</span> <span class="n">BidsRoot</span><span class="p">(</span><span class="n">BIDS_ROOT</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;bids_root&#39;</span><span class="p">]),</span>
                     <span class="n">center_id</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;center_id&#39;</span><span class="p">]</span>
                     <span class="p">)</span>
<span class="n">subject_wildcard</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{subject}</span><span class="s2">&quot;</span>

<span class="c1"># initialize directories that we access in this snakemake</span>
<span class="n">FS_DIR</span> <span class="o">=</span> <span class="n">bids_root</span><span class="o">.</span><span class="n">freesurfer_dir</span>
<span class="n">RAW_CT_FOLDER</span> <span class="o">=</span> <span class="n">bids_root</span><span class="o">.</span><span class="n">get_rawct_dir</span><span class="p">(</span><span class="n">subject_wildcard</span><span class="p">)</span>
<span class="n">RAW_MRI_FOLDER</span> <span class="o">=</span> <span class="n">bids_root</span><span class="o">.</span><span class="n">get_premri_dir</span><span class="p">(</span><span class="n">subject_wildcard</span><span class="p">)</span>
<span class="n">FSOUT_MRI_FOLDER</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">bids_root</span><span class="o">.</span><span class="n">get_freesurfer_patient_dir</span><span class="p">(</span><span class="n">subject_wildcard</span><span class="p">))</span> <span class="o">/</span> <span class="s2">&quot;mri&quot;</span>
<span class="n">FSOUT_CT_FOLDER</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">bids_root</span><span class="o">.</span><span class="n">get_freesurfer_patient_dir</span><span class="p">(</span><span class="n">subject_wildcard</span><span class="p">))</span> <span class="o">/</span> <span class="s2">&quot;CT&quot;</span>
<span class="n">FSOUT_ACPC_FOLDER</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">bids_root</span><span class="o">.</span><span class="n">get_freesurfer_patient_dir</span><span class="p">(</span><span class="n">subject_wildcard</span><span class="p">))</span> <span class="o">/</span> <span class="s2">&quot;acpc&quot;</span>

<span class="n">BIDS_PRESURG_ANAT_DIR</span> <span class="o">=</span> <span class="n">_get_anat_bids_dir</span><span class="p">(</span><span class="n">bids_root</span><span class="o">.</span><span class="n">bids_root</span><span class="p">,</span> <span class="n">subject_wildcard</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="s1">&#39;presurgery&#39;</span><span class="p">)</span>
<span class="n">premri_native_bids_fname</span> <span class="o">=</span> <span class="n">_get_bids_basename</span><span class="p">(</span><span class="n">subject_wildcard</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="s1">&#39;presurgery&#39;</span><span class="p">,</span>
                                              <span class="n">imgtype</span><span class="o">=</span><span class="s1">&#39;T1w&#39;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s1">&#39;nii&#39;</span><span class="p">)</span>
<span class="n">premri_bids_fname</span> <span class="o">=</span> <span class="n">_get_bids_basename</span><span class="p">(</span><span class="n">subject_wildcard</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="s1">&#39;presurgery&#39;</span><span class="p">,</span>
                                       <span class="n">space</span><span class="o">=</span><span class="s1">&#39;RAS&#39;</span><span class="p">,</span> <span class="n">imgtype</span><span class="o">=</span><span class="s1">&#39;T1w&#39;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s1">&#39;nii&#39;</span><span class="p">)</span>
<span class="n">ct_bids_fname</span> <span class="o">=</span> <span class="n">_get_bids_basename</span><span class="p">(</span><span class="n">subject_wildcard</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="s1">&#39;presurgery&#39;</span><span class="p">,</span>
                                   <span class="n">imgtype</span><span class="o">=</span><span class="s1">&#39;CT&#39;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s1">&#39;nii&#39;</span><span class="p">)</span>

<span class="c1"># First rule</span>
<span class="n">rule</span> <span class="nb">all</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span>
         <span class="n">MRI_bids_fname_fscopy</span><span class="o">=</span><span class="n">expand</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">FSOUT_ACPC_FOLDER</span><span class="p">,</span> <span class="n">premri_native_bids_fname</span><span class="p">),</span>
                                      <span class="n">subject</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;patients&#39;</span><span class="p">]),</span>
         <span class="n">MRI_NIFTI_IMG</span><span class="o">=</span><span class="n">expand</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BIDS_PRESURG_ANAT_DIR</span><span class="p">,</span> <span class="n">premri_bids_fname</span><span class="p">),</span>
                              <span class="n">subject</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;patients&#39;</span><span class="p">]),</span>
    <span class="n">params</span><span class="p">:</span>
          <span class="n">bids_root</span><span class="o">=</span><span class="n">bids_root</span><span class="o">.</span><span class="n">bids_root</span><span class="p">,</span>
    <span class="n">shell</span><span class="p">:</span>
         <span class="s2">&quot;echo &#39;done&#39;;&quot;</span>
         <span class="s2">&quot;bids-validator </span><span class="si">{params.bids_root}</span><span class="s2">;&quot;</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Rule for prepping fs_recon by converting dicoms -&gt; NIFTI images.</span>

<span class="sd">For more information, see BIDS specification.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">rule</span> <span class="n">convert_dicom_to_nifti</span><span class="p">:</span>
    <span class="n">params</span><span class="p">:</span>
          <span class="n">CT_FOLDER</span><span class="o">=</span><span class="n">RAW_CT_FOLDER</span><span class="p">,</span>
          <span class="n">MRI_FOLDER</span><span class="o">=</span><span class="n">RAW_MRI_FOLDER</span><span class="p">,</span>
          <span class="n">bids_root</span><span class="o">=</span><span class="n">bids_root</span><span class="o">.</span><span class="n">bids_root</span><span class="p">,</span>
    <span class="n">output</span><span class="p">:</span>
          <span class="n">CT_bids_fname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BIDS_PRESURG_ANAT_DIR</span><span class="p">,</span> <span class="n">ct_bids_fname</span><span class="p">),</span>
          <span class="n">MRI_bids_fname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BIDS_PRESURG_ANAT_DIR</span><span class="p">,</span> <span class="n">premri_native_bids_fname</span><span class="p">),</span>
    <span class="n">shell</span><span class="p">:</span>
         <span class="s2">&quot;mrconvert </span><span class="si">{params.CT_FOLDER}</span><span class="s2"> </span><span class="si">{output.CT_bids_fname}</span><span class="s2">;&quot;</span>
         <span class="s2">&quot;mrconvert </span><span class="si">{params.MRI_FOLDER}</span><span class="s2"> </span><span class="si">{output.MRI_bids_fname}</span><span class="s2">;&quot;</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Rule for automatic ACPC alignment using acpcdetect software. </span>

<span class="sd">Please check the output images to quality assure that the ACPC was properly</span>
<span class="sd">aligned.  </span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">rule</span> <span class="n">automatic_acpc_alignment</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">:</span>
         <span class="n">MRI_bids_fname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BIDS_PRESURG_ANAT_DIR</span><span class="p">,</span> <span class="n">premri_native_bids_fname</span><span class="p">),</span>
    <span class="n">params</span><span class="p">:</span>
          <span class="n">anat_dir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">BIDS_PRESURG_ANAT_DIR</span><span class="p">),</span>
          <span class="n">acpc_fs_dir</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">FSOUT_ACPC_FOLDER</span><span class="p">),</span>
    <span class="n">output</span><span class="p">:</span>
          <span class="n">MRI_bids_fname_fscopy</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">FSOUT_ACPC_FOLDER</span><span class="p">,</span> <span class="n">premri_native_bids_fname</span><span class="p">),</span>
          <span class="n">MRI_bids_fname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BIDS_PRESURG_ANAT_DIR</span><span class="p">,</span> <span class="n">premri_bids_fname</span><span class="p">),</span>
    <span class="n">shell</span><span class="p">:</span>
         <span class="c1"># create BIDS session directory and copy file there</span>
         <span class="s2">&quot;echo &#39;acpcdetect -i </span><span class="si">{input.MRI_bids_fname}</span><span class="s2"> -center-AC -output-orient RAS;&#39;&quot;</span>
         <span class="s2">&quot;echo </span><span class="si">{output.MRI_bids_fname}</span><span class="s2">;&quot;</span>
         <span class="s2">&quot;mkdir -p </span><span class="si">{params.acpc_fs_dir}</span><span class="s2">;&quot;</span>
         <span class="s2">&quot;cp </span><span class="si">{input.MRI_bids_fname}</span><span class="s2"> </span><span class="si">{output.MRI_bids_fname_fscopy}</span><span class="s2">;&quot;</span>
         <span class="c1"># run acpc auto detection</span>
         <span class="s2">&quot;acpcdetect -i </span><span class="si">{output.MRI_bids_fname_fscopy}</span><span class="s2"> -center-AC -output-orient RAS;&quot;</span>
         <span class="s2">&quot;cp </span><span class="si">{output.MRI_bids_fname_fscopy}</span><span class="s2"> </span><span class="si">{output.MRI_bids_fname}</span><span class="s2">;&quot;</span>

         <span class="c1"># not needed unless defacing is used...</span>
         <span class="c1"># rule nifti_to_bids:</span>
         <span class="c1">#     params:</span>
         <span class="c1">#         CT_FOLDER = RAW_CT_FOLDER,</span>
         <span class="c1">#         MRI_FOLDER = RAW_POSTMRI_FOLDER,</span>
         <span class="c1">#         bids_root = bids_root.bids_root,</span>
         <span class="c1">#     output:</span>
         <span class="c1">#         CT_bids_fname = os.path.join(_get_anat_bids_dir(bids_root.bids_root, subject_wildcard),</span>
         <span class="c1">#                                      _get_bids_basename(subject_wildcard, imgtype=&#39;CT&#39;)),</span>
         <span class="c1">#         MRI_bids_fname = os.path.join(_get_anat_bids_dir(bids_root.bids_root, subject_wildcard),</span>
         <span class="c1">#                                      _get_bids_basename(subject_wildcard, imgtype=&#39;T1w&#39;))</span>
         <span class="c1">#     run:</span>
         <span class="c1">#         bids_conversion._convert_dicom_to_nifti(params.CT_FOLDER, output.CT_bids_fname)</span>
         <span class="c1">#         bids_conversion.convert_img_to_bids(params.MRI_FOLDER, params.bids_root, output.MRI_bids_fname)</span>
</code></pre></div>

</details>
<p>In order to use a Sequana rule in your pipeline, add this code:</p>
<div class="highlight"><pre><span></span><code>from sequana import snaketools as sm
include: sm.modules<span class="o">[</span><span class="s2">&quot;fastq_sampling&quot;</span><span class="o">]</span>
</code></pre></div>

<p>This takes care of the physical location of the rule. Of course, you will then need to look at the documentation and define the required variables in your pipeline. For instance, in the example above, given the documentation, you will need to define those two variables:</p>
<div class="highlight"><pre><span></span><code>__fastq_sampling_input_fastq
__fastq_sampling_output_fastq
</code></pre></div>

<p>and have a configuration file with:</p>
<div class="highlight"><pre><span></span><code>fastq_sampling:
     N: <span class="m">1000</span>
</code></pre></div>

<p>Many rules are used inside the Sequana pipelines but not all. For instance, the <strong>codecs</strong> rules (e.g. gz_to_bzip) are used in standalones.</p>
<p>Please see the :ref:<code>pipelines</code> section for other rule documentation (e.g. bwa, fastqc, ...).</p>
  
    
  

              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="data_description.html" title="Dataset Description" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Dataset Description
              </div>
            </div>
          </a>
        
        
          <a href="../contributing.html" title="Contributing" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Contributing
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 SEEK Developers
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/ncsl/seek" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://hub.docker.com/u/neuroseek" target="_blank" rel="noopener" title="hub.docker.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.de50e36d.min.js"></script>
      <script src="../assets/javascripts/bundle.38f5c9b5.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.9b3611bd.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://unpkg.com/mermaid@8.4.4/dist/mermaid.min.js"></script>
      
    
  </body>
</html>